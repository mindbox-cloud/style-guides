## Стандарты кодирования &mdash; C#

### TOC
1. [Можно ли использовать матерные слова в коде?](#Можно-ли-использовать-матерные-слова-в-коде)
1. [Как разделять члены класса пустыми строками?](#Как-разделять-члены-класса-пустыми-строками)
1. [Как группировать и сортировать члены класса?](#Как-группировать-и-сортировать-члены-класса?)
1. [Какая максимальная длина строки?](#Какая-максимальная-длина-строки)
1. [Можно ли использовать поля с видимостью отличной от private?](#Можно-ли-использовать-поля-с-видимостью-отличной-от-private)
1. [Пробелы или табуляция?](#Пробелы-или-табуляция)
1. [Допустимы ли пробелы в конце строки?](#Допустимы-ли-пробелы-в-конце-строки)
1. [Проверяемые stylecop правила](#Проверяемые-stylecop-правила)
    * [XML документация](#XML-документация)
    * [Maintainability](#Maintainability)
    * [Naming](#Naming)
    * [Ordering](#Ordering)
    * [Readability](#Readability)
    * [Spacing](#Spacing)
1. [Рекомендации по использованию исключений](#Рекомендации-по-использованию-исключений)

### Можно ли использовать матерные слова в коде?
Нет.
Поучительная история по [ссылке](https://mindbox.fogbugz.com/default.asp?W1418).

### Как разделять члены класса пустыми строками?

- Никогда не должно быть трёх пустых строк подряд.
- Члены класса/структуры/интерфейса одного вида и видимости, совпадающие по `static`/`instance`, должны разделяться не более чем одной пустой строкой.
- Многострочные методы, многострочные свойства, вложенные классы, структуры, интерфейсы и перечисления отделяем как минимум одной пустой строкой от любых членов.

Историческое голосование по [ссылке](https://mindbox.fogbugz.com/default.asp?W244).

### Как группировать и сортировать члены класса?

1. Константы и статические члены (можно отделить регионом)
1. Поля
1. Конструкторы
1. Свойства
1. Публичные методы
1. Приватные методы
1. Методы, реализующие интерфейсы.

Историческое голосование по [ссылке](https://mindbox.fogbugz.com/default.asp?W255).

### Какая максимальная длина строки?

- Максимальная допустимая длина строки — 130 символов
- Символ табуляция считается за 4 символа
- Пробельные символы в конце строки _учитываются_

Историческое голосование по [ссылке](https://mindbox.fogbugz.com/default.asp?W245).

### Можно ли использовать поля с видимостью отличной от private?
Нет.

Историческое голосование по [ссылке](https://mindbox.fogbugz.com/default.asp?W247).

### Пробелы или табуляция?

- Отступы должны формироваться только с помощью **табуляции**.
- Символ табуляции должен использоваться только для отступов в начале строки или в конце строки.
- В коде не должно быть двух пробельных символов подряд, за исключением отступов в начале строки, в конце строки, комментариев и строковых констант.

Историческое голосование по [ссылке](https://mindbox.fogbugz.com/default.asp?W254).

### Допустимы ли пробелы в конце строки?

В конце строк разрешаем произвольное количество произвольных пробельных символов.
Пробельные символы в конце строки учитываем при определении длины строки

 
### Проверяемые stylecop правила
Как мы уже раньше обсуждали, имеет смысл нам более жёстко подойти к вопросу стандартов кодирования. Для автоматической валидации оформления кода мы использовали StyleCop — свободную утилиту, которую сначала Microsoft разрабатывала для себя. С приходом C#6 поддержка StyleCop прекратилась, и мы перешли на опен-сорс реализацию правил StyleCop на основа Roslyn Analyzers.

Дополнительно мы реализовали некоторые свои правила по той же технологии.

-----
#### XML документация
  - XML документация является валидным XML
  - В XML документации summary не совпадает с автоматически генерируемым Visual Studio
  - Описанные в XML документации параметры существуют, имеют имя и текст описания
  - Описанное в XML документации возвращаемое значение существует и имеет текст описания
  - Описанные в XML документации generic параметр существуют, имеют имя и текст описания
  - XML документация не copy-paste'ится
  - XML документация не должна использоваться для обычных комментариев
  - XML документация не должна быть пустой
  - Текст XML документации должен начинаться с прописной (большой) буквы
  - Текст XML документации должен заканчиваться точкой
  - Включенные в XML ссылки на другие элементы и файлы должны ссылаться на существующие элементы и файлы
  - Включенная в XML ссылка на документацию из базового класса должна быть только в классах-наследниках
#### Maintainability
  - поля должны быть приватными
  - в одном файле может находится только одно пространство имён
#### Naming
  - названия пространств имён, классов, перечислений, структур, делегатов, событий, методов и свойств должны начинаться с прописной (большой) буквы
  - названия интерфейсов должны начинаться с префикса `I`
  - название `readonly` полей, если они `public`, `internal`, `protected` или `protected internal`, должны начинаться с прописной (большой) буквы (за исключением полей в классах, названия которых заканчиваются на `NativeMethods`)
  - названия полей не должны использовать венгерскую нотацию
  - названия полей не должны начинаться с префиксов `m_` и `s_`
  - названия полей не долдны начинаться с символа подчёркивания (`_`)
#### Ordering
  - Все статические члены должны быть описаны раньше всех `instance` членов
#### Readability
  - Комментарии должны иметь текст
  - Несколько операторов не должно находиться на одной строке
#### Spacing
  - После запятой, точки с запятой должен идти пробел (кроме как в конце строки), а до запятой &mdash; не должен (кроме как в начале строки)
  - XML документация должна отделяться от `///` пробелом
  - однострочные комментарии должны отделяться от `//` пробелом
------

### Рекомендации по использованию исключений
- Падаем как можно раньше к месту возникновения ошибки
- Из сообщения об ошибке должно быть понятно, почему упали и что делать
- Все исключительные ситуации (в т.ч. обработанные) должны попадать в логи, запрещается просто гасить исключения
- Исключение – `ValidationException`, ее обработка происходит без лога, в остальном – исключения не используются для передачи управления
- Если программист ошибся – приложение должно просто упасть. Т.е. нужно выкинуть `InvalidOperationException`, `CodeContract` или `ArgumentException`.
- Необходимо четко отличать внутренние ошибки (т.е. наших программистов, например нарушения контракта кода) от ошибок внешних клиентов (некорректный формат запроса) и ошибок ввода пользователя (т.е. валидационных сообщений).
- Если ошибка – результат некорректного ввода пользователя (или некорректных параметров сервиса, если они вводятся пользователем) – он должен увидеть сообщение об ошибке. Программа не должна упасть целиком. Обычно реализуется через ValidationException
- Никогда не ловите эксепшен, ничего с ним не делая.
- Ловите эксепшены только в том случае, если можете их хоть как-то обработать.
- Никогда не используте эксепшены для управления ходом выполнения программы.
- Старайтесь ловить конкретные классы эксепшенов.
- Все эксепшены (ошибки) выходящие за границу приложения в виде ошибочных сообщений пользователю (кроме `ValidationException` преобразованного в вывод ошибок в UI приложения) должны попадать в Log с соответствующем уровнем.
- Все глотаемые эксепшены (т.е. не вызвающие падения приложения или сообщений об ошибках) должны попадать в Log (скорее всего – как `Error`, `Warning` или `Info`).
- Старайтесь прокидывать эксепшены дальше, чтобы не терялся стек. Если это невозможно, или вы очень хотите кинуть эксепшн с более детальным сообщением об ошибке, всегда инициализируйте поле `innerException`.
- Не нужно ловить ЛЮБЫЕ эксепшены. Пусть лучше приложение упадет. Будет проще отлаживать. Делайте так только в случае, если это вытекает из бизнес требований.
